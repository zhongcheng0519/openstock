# 股票分析系统产品需求文档 (PRD)

## 文档信息

| 项目名称 | 股票分析系统 (Stock Analysis System) |
| -------- | ------------------------------------ |
| 版本     | 1.0                                  |
| 状态     | 规划中                               |

---

## 1. 产品概述

### 1.1 产品定位

股票分析系统是一个面向个人投资者和量化研究人员的股票筛选与分析平台。系统通过整合 Tushare 数据源，提供多维度的股票筛选功能，帮助用户快速发现符合特定条件的投资标的。

### 1.2 目标用户

| 用户类型       | 描述                                       |
| -------------- | ------------------------------------------ |
| 个人投资者     | 需要快速筛选股票、分析资金流向的个人用户   |
| 量化研究人员   | 需要数据进行策略验证和研究的专业人士       |
| 系统管理员     | 负责用户管理和系统运维的管理人员           |

### 1.3 核心价值

- **高效筛选**: 多维度条件组合筛选，快速定位目标股票
- **数据可靠**: 基于 Tushare Pro 数据源，数据质量有保障
- **资金追踪**: 资金流向分析，洞察主力资金动向
- **安全可控**: 完善的用户权限管理，操作可审计

---

## 2. 功能需求

### 2.1 用户管理模块

#### 2.1.1 用户注册与初始化

| 功能点         | 描述                                                    |
| -------------- | ------------------------------------------------------- |
| 首次注册       | 系统无用户时，允许注册第一个用户，自动成为管理员        |
| 注册限制       | 系统已有用户后，关闭公开注册功能                        |
| 必填信息       | 用户名、密码、邮箱                                      |

**业务规则**:
- 第一个注册的用户自动获得管理员权限
- 后续用户只能由管理员创建
- 用户名唯一，不可重复

#### 2.1.2 用户登录

| 功能点         | 描述                                                    |
| -------------- | ------------------------------------------------------- |
| 账号密码登录   | 使用用户名和密码进行登录                                |
| Token 认证     | 登录成功后返回 JWT Token，用于后续请求认证              |
| 登录记录       | 记录登录时间、IP 地址、设备信息                         |

**业务规则**:
- 登录失败需提示具体原因（用户不存在/密码错误/账号禁用）
- Token 有效期 1 小时，过期需重新登录

#### 2.1.3 密码管理

| 功能点         | 描述                                                    |
| -------------- | ------------------------------------------------------- |
| 用户修改密码   | 用户可修改自己的密码，需验证旧密码                      |
| 管理员重置密码 | 管理员可重置任意用户的密码                              |

**业务规则**:
- 修改密码需验证旧密码
- 新密码需满足安全要求（长度、复杂度）

#### 2.1.4 用户管理（管理员功能）

| 功能点         | 描述                                                    |
| -------------- | ------------------------------------------------------- |
| 查看用户列表   | 分页查看所有用户信息                                    |
| 创建用户       | 创建新用户，指定角色和初始密码                          |
| 禁用/启用用户  | 禁用或启用用户账号                                      |
| 删除用户       | 删除用户账号（不可删除自己和最后一个管理员）            |

**业务规则**:
- 管理员不能删除自己的账号
- 系统至少保留一个管理员账号
- 禁用用户后，该用户无法登录

---

### 2.2 股票筛选模块

#### 2.2.1 多维度筛选

| 筛选维度       | 说明                           | 默认值        |
| -------------- | ------------------------------ | ------------- |
| 交易日期       | 指定筛选的交易日期             | 必填          |
| 涨跌幅范围     | 设置涨跌幅的上下限             | -100% ~ 100%  |
| 流通市值范围   | 设置流通市值的上下限           | 最小 50 亿    |
| 市盈率范围     | 设置市盈率的上下限             | 0 ~ 50        |
| 换手率范围     | 设置换手率的上下限             | 最小 5%       |
| 净流入额       | 设置最小净流入额               | 可选          |
| 结果数量       | 按净流入额排序取前 N 只        | 30            |

**业务规则**:
- 所有筛选条件之间为"且"关系
- 数据按需同步：若本地无该日期数据，自动从 Tushare 获取

#### 2.2.2 筛选结果展示

| 展示内容       | 说明                                         |
| -------------- | -------------------------------------------- |
| 股票基本信息   | 股票代码、名称、所属行业                     |
| 行情数据       | 开盘价、最高价、最低价、收盘价、涨跌幅       |
| 基本面数据     | 流通市值、市盈率、换手率                     |
| 资金流向数据   | 净流入额、净流入量                           |

**响应式设计**:
- 桌面端：表格展示所有字段
- 移动端：卡片式展示核心信息，点击展开详情

---

### 2.3 数据同步模块

#### 2.3.1 数据同步策略

| 数据类型       | 同步时机                                     | 数据源          |
| -------------- | -------------------------------------------- | --------------- |
| 股票基础信息   | 首次启动或定期更新                           | Tushare stock_basic |
| 日线行情       | 用户请求时按需同步                           | Tushare daily   |
| 基本面指标     | 用户请求时按需同步                           | Tushare daily_basic |
| 资金流向       | 用户请求时按需同步                           | Tushare moneyflow |

**业务规则**:
- 同步前检查本地是否已有该日期数据
- 批量插入数据以提高性能
- 数据持久化到 PostgreSQL 数据库

---

### 2.4 操作审计模块

#### 2.4.1 日志记录（管理员功能）

| 记录内容       | 说明                                         |
| -------------- | -------------------------------------------- |
| 操作用户       | 执行操作的用户 ID 和用户名                   |
| 操作类型       | login/logout/filter/export 等                |
| 操作资源       | 请求的 API 路径                              |
| 请求参数       | 请求参数（敏感信息脱敏）                     |
| 客户端信息     | IP 地址、User-Agent                          |
| 响应状态       | HTTP 状态码                                  |
| 操作时间       | 操作发生的时间                               |

#### 2.4.2 日志查询（管理员功能）

| 功能点         | 描述                                         |
| -------------- | -------------------------------------------- |
| 分页查询       | 支持分页浏览操作日志                         |
| 多条件筛选     | 按用户、操作类型、时间范围筛选               |
| 操作统计       | 统计各类操作的数量和分布                     |

---

## 3. 非功能需求

### 3.1 性能要求

| 指标           | 要求                                         |
| -------------- | -------------------------------------------- |
| 页面加载时间   | 首屏加载 < 3 秒                              |
| API 响应时间   | 普通请求 < 500ms，筛选请求 < 2 秒            |
| 数据同步       | 单日数据同步 < 10 秒                         |

### 3.2 安全要求

| 安全措施       | 说明                                         |
| -------------- | -------------------------------------------- |
| 密码存储       | 使用 bcrypt 加密，cost factor = 12           |
| 传输加密       | HTTPS 加密传输                               |
| 认证机制       | JWT Token 认证，有效期 1 小时                |
| 权限控制       | 基于角色的访问控制（RBAC）                   |
| 操作审计       | 记录所有用户操作，支持追溯                   |

### 3.3 可用性要求

| 指标           | 要求                                         |
| -------------- | -------------------------------------------- |
| 系统可用性     | 99% 以上                                     |
| 数据备份       | 每日自动备份数据库                           |
| 故障恢复       | 关键故障 4 小时内恢复                        |

### 3.4 兼容性要求

| 平台           | 要求                                         |
| -------------- | -------------------------------------------- |
| 浏览器         | Chrome、Firefox、Safari 最新两个主版本       |
| 设备           | 桌面端、平板、手机响应式适配                 |
| 操作系统       | macOS、Windows、Linux                        |

---

## 4. 用户角色与权限

### 4.1 角色定义

| 角色           | 描述                                         |
| -------------- | -------------------------------------------- |
| admin（管理员）| 系统管理员，拥有所有权限                     |
| user（普通用户）| 普通用户，仅能使用股票筛选功能               |

### 4.2 权限矩阵

| 功能模块       | admin | user  |
| -------------- | :---: | :---: |
| 用户登录       | ✓     | ✓     |
| 修改个人密码   | ✓     | ✓     |
| 股票筛选       | ✓     | ✓     |
| 数据导出       | ✓     | ✓     |
| 用户管理       | ✓     | ✗     |
| 查看操作日志   | ✓     | ✗     |
| 操作统计       | ✓     | ✗     |

---

## 5. 用户故事

### 5.1 用户管理

```
US-001: 首次系统初始化
作为 系统部署者
我希望 能够注册第一个管理员账号
以便 完成系统初始化并开始使用

验收标准：
- 系统无用户时，注册接口可用
- 第一个注册用户自动成为管理员
- 注册成功后返回用户信息
```

```
US-002: 用户登录
作为 已注册用户
我希望 能够通过账号密码登录系统
以便 使用股票筛选功能

验收标准：
- 输入正确的用户名和密码可成功登录
- 登录成功返回 JWT Token
- 记录登录日志
```

```
US-003: 修改密码
作为 登录用户
我希望 能够修改自己的密码
以便 保护账号安全

验收标准：
- 需验证旧密码才能修改
- 新密码需满足安全要求
- 修改成功后需重新登录
```

```
US-004: 管理员创建用户
作为 管理员
我希望 能够创建新的用户账号
以便 为团队成员分配系统访问权限

验收标准：
- 可指定用户名、密码、邮箱、角色
- 用户名不能重复
- 创建成功后新用户可登录
```

```
US-005: 管理员禁用用户
作为 管理员
我希望 能够禁用违规用户
以便 控制系统访问权限

验收标准：
- 禁用后用户无法登录
- 可重新启用用户
- 不能禁用自己
```

### 5.2 股票筛选

```
US-006: 多条件股票筛选
作为 登录用户
我希望 能够设置多个筛选条件查找股票
以便 快速找到符合投资策略的标的

验收标准：
- 可设置涨跌幅、市值、市盈率、换手率等条件
- 所有条件为"且"关系
- 结果按净流入额排序
- 支持限制返回数量
```

```
US-007: 查看筛选结果
作为 登录用户
我希望 能够清晰查看筛选结果
以便 分析股票数据

验收标准：
- 桌面端以表格展示完整数据
- 移动端以卡片展示核心数据
- 可点击查看详情
```

```
US-008: 数据自动同步
作为 登录用户
我希望 系统能自动获取缺失的数据
以便 无需手动触发数据更新

验收标准：
- 请求日期数据不存在时自动同步
- 同步过程对用户透明
- 同步完成后返回筛选结果
```

### 5.3 操作审计

```
US-009: 查看操作日志
作为 管理员
我希望 能够查看所有用户的操作记录
以便 审计系统使用情况

验收标准：
- 支持分页查询
- 支持按用户、时间、操作类型筛选
- 显示完整的操作信息
```

```
US-010: 操作统计分析
作为 管理员
我希望 能够查看操作统计数据
以便 了解系统使用情况

验收标准：
- 统计总请求数、活跃用户数
- 按操作类型统计分布
- 按用户统计使用频率
```

---

## 6. 数据字典

### 6.1 股票数据

| 数据项         | 类型       | 说明                           |
| -------------- | ---------- | ------------------------------ |
| ts_code        | String     | 股票代码（如 000001.SZ）       |
| symbol         | String     | 股票代码（如 000001）          |
| name           | String     | 股票名称                       |
| trade_date     | Date       | 交易日期                       |
| open           | Numeric    | 开盘价                         |
| high           | Numeric    | 最高价                         |
| low            | Numeric    | 最低价                         |
| close          | Numeric    | 收盘价                         |
| pct_chg        | Numeric    | 涨跌幅（%）                    |
| vol            | Numeric    | 成交量（手）                   |
| amount         | Numeric    | 成交额（千元）                 |
| circ_mv        | Numeric    | 流通市值（万元）               |
| pe             | Numeric    | 市盈率                         |
| turnover_rate  | Numeric    | 换手率（%）                    |
| net_mf_amount  | Numeric    | 净流入额（万元）               |

### 6.2 用户数据

| 数据项         | 类型       | 说明                           |
| -------------- | ---------- | ------------------------------ |
| id             | BigInt     | 用户 ID                        |
| username       | String     | 用户名                         |
| email          | String     | 邮箱地址                       |
| role           | String     | 角色（admin/user）             |
| is_active      | Boolean    | 是否激活                       |
| created_at     | DateTime   | 创建时间                       |

---

## 7. 接口清单

### 7.1 认证接口

| 方法 | 路径                        | 说明               | 权限    |
| ---- | --------------------------- | ------------------ | ------- |
| POST | /api/v1/auth/register       | 用户注册（首次）   | 公开    |
| POST | /api/v1/auth/login          | 用户登录           | 公开    |
| POST | /api/v1/auth/logout         | 用户登出           | 登录    |
| PUT  | /api/v1/auth/password       | 修改密码           | 登录    |

### 7.2 用户管理接口

| 方法   | 路径                                | 说明           | 权限    |
| ------ | ----------------------------------- | -------------- | ------- |
| GET    | /api/v1/admin/users                 | 用户列表       | admin   |
| POST   | /api/v1/admin/users                 | 创建用户       | admin   |
| PUT    | /api/v1/admin/users/{user_id}       | 更新用户状态   | admin   |
| PUT    | /api/v1/admin/users/{user_id}/reset-password | 重置密码 | admin   |
| DELETE | /api/v1/admin/users/{user_id}       | 删除用户       | admin   |

### 7.3 操作日志接口

| 方法 | 路径                          | 说明           | 权限    |
| ---- | ----------------------------- | -------------- | ------- |
| GET  | /api/v1/admin/logs            | 操作日志列表   | admin   |
| GET  | /api/v1/admin/logs/statistics | 操作统计       | admin   |

### 7.4 业务接口

| 方法 | 路径                      | 说明       | 权限    |
| ---- | ------------------------- | ---------- | ------- |
| POST | /api/v1/strategy/filter   | 股票筛选   | 登录    |

---

## 8. 里程碑规划

### Phase 1: 基础框架（MVP）

- [ ] 用户认证模块（注册、登录、登出）
- [ ] 股票基础信息同步
- [ ] 日线行情数据同步
- [ ] 基础股票筛选功能

### Phase 2: 核心功能

- [ ] 基本面指标数据同步
- [ ] 资金流向数据同步
- [ ] 多维度筛选功能完善
- [ ] 用户管理功能

### Phase 3: 增强功能

- [ ] 操作日志记录
- [ ] 操作统计分析
- [ ] 数据导出功能
- [ ] 移动端适配优化

### Phase 4: 扩展功能

- [ ] 策略保存与分享
- [ ] 数据可视化图表
- [ ] 高级量化策略支持

---

## 9. 风险与约束

### 9.1 技术风险

| 风险项                     | 影响   | 应对措施                           |
| -------------------------- | ------ | ---------------------------------- |
| Tushare 接口限流           | 中     | 实现请求队列和重试机制             |
| 数据量增长导致性能下降     | 中     | 合理设计索引，定期归档历史数据     |
| 并发请求压力               | 低     | 异步处理，连接池管理               |

### 9.2 业务约束

| 约束项                     | 说明                                       |
| -------------------------- | ------------------------------------------ |
| Tushare 积分要求           | 资金流向数据需要至少 2000 积分             |
| 数据延迟                   | Tushare 数据可能有 1-2 天延迟              |
| 用户数量限制               | 系统设计为小团队使用，不建议大规模部署     |

---

## 10. 附录

### 10.1 术语表

| 术语           | 说明                                         |
| -------------- | -------------------------------------------- |
| Tushare        | 开源的金融数据接口                           |
| JWT            | JSON Web Token，一种身份认证标准             |
| RBAC           | 基于角色的访问控制                           |
| 流通市值       | 流通股数量 × 股价                            |
| 市盈率 (PE)    | 股价 / 每股收益                              |
| 换手率         | 成交量 / 流通股本 × 100%                     |
| 净流入额       | 买入金额 - 卖出金额                          |

### 10.2 参考文档

- [Tushare Pro API 文档](https://tushare.pro/document/2)
- [FastAPI 官方文档](https://fastapi.tiangolo.com/)
- [Vue 3 官方文档](https://vuejs.org/)
